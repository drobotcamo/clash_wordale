var test = document.getElementById("test");
var test_style = window.getComputedStyle(test)
var inProgress = false;

test.setAttribute("card_name", "bbl");

test.addEventListener('click', () => {
    if(!inProgress) {
        inProgress = true;
        var halfDurationMilliseconds = getAnimationDuration(test_style.transition) * 1000;
        test.style.transform = "rotateY(90deg)";

        if(test.getAttribute("card_name") == "bbl") {
            setTimeout(() => {
                test.src = "https://cdn.royaleapi.com/static/img/cards-150/goblin-barrel.png";
                test.style.transform = "rotateY(0)";
                test.setAttribute("card_name", "gbl");
            }, (halfDurationMilliseconds));
        } else if(test.getAttribute("card_name") == "gbl") {
            setTimeout(() => {
                test.src = "https://cdn.royaleapi.com/static/img/cards-150/barbarian-barrel.png";
                test.style.transform = "rotateY(0)";
                test.setAttribute("card_name", "bbl");
            }, (halfDurationMilliseconds));
        }

        setTimeout(() => {
            inProgress = false;
        }, halfDurationMilliseconds * 2);
    }
});

// Returns the duration of an animation in seconds, as a float
// params:
//   transitionString: a string generated by executing window.getComputedStyle(element).transition on an element
function getAnimationDuration(transitionString) {
    var start = transitionString.indexOf(" ") + 1;
    var substring1 = transitionString.slice(start);
    var end = substring1.indexOf("s");
    var timeString = substring1.slice(0, end);

    return parseFloat(timeString);
}

console.log($("screen"));
